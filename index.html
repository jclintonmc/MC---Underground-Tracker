<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Underground Linear FT Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
  --border:#374151; --primary:#2563eb; --success:#16a34a;
  --gray:#475569; --danger:#7f1d1d;
}
body{margin:0;padding:30px;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
.card{max-width:1400px;margin:auto;background:var(--card);border-radius:18px;padding:26px;box-shadow:0 30px 60px rgba(0,0,0,.35)}
h1{margin:0;font-size:28px}
.subtitle{color:var(--muted);margin:6px 0 22px}
.row{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end}
.col{flex:1;min-width:180px}
label{font-size:12px;color:var(--muted)}
input,select{width:100%;padding:11px;border-radius:12px;border:1px solid var(--border);background:#020617;color:var(--text)}
.btn{padding:11px 20px;border-radius:14px;border:none;cursor:pointer}
.primary{background:var(--primary);color:white}
.success{background:var(--success);color:white}
.gray{background:var(--gray);color:white}
.danger{background:var(--danger);color:white}
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-top:22px}
.kpi{background:#020617;border-radius:999px;padding:18px;text-align:center}
.kpi span{font-size:12px;color:var(--muted)}
.kpi strong{display:block;font-size:22px}
table{width:100%;border-collapse:collapse;margin-top:26px}
th,td{border-bottom:1px solid var(--border);padding:10px;text-align:right}
th:first-child,td:first-child{text-align:left}
.del{background:#7f1d1d;color:white;border:none;border-radius:10px;padding:6px 10px;cursor:pointer}
.mode-box{background:#020617;border:1px solid var(--border);border-radius:14px;padding:12px}
.mode-box .weights{display:flex;gap:8px;margin-top:8px}
.icon-btn{width:44px;height:44px;border-radius:12px;border:1px solid var(--border);background:#1f2937;color:white;cursor:pointer}
.cost-manager{display:none;margin-top:14px;padding:16px;border-radius:14px;background:#020617;border:1px solid #1f2937}
</style>
</head>

<body>
<div class="card">

<!-- HEADER -->
<div class="row">
  <div style="flex:1">
    <h1>Underground Linear FT Tracker</h1>
    <div class="subtitle">Production + Activity-Distributed Progress Tracking</div>
  </div>

  <div class="mode-box" style="min-width:320px">
    <label>Entry Mode</label>
    <select>
      <option>Manual Input</option>
      <option disabled>Weighted Split (future)</option>
    </select>
    <div class="weights">
      <input value="8" readonly>
      <input value="42" readonly>
      <input value="25" readonly>
      <input value="25" readonly>
    </div>
    <div style="font-size:11px;color:#94a3b8;margin-top:4px">Dig / Lay / Backfill %</div>
  </div>
</div>

<!-- ENTRY -->
<div class="row" style="margin-top:14px">
  <div class="col"><label>Date</label><input type="date" id="date"></div>
  <div class="col"><label>Project</label><input id="project"></div>
  <div class="col"><label>Crew Lead</label><input id="crew"></div>
  <div class="col">
    <label>Cost Code</label>
    <div style="display:flex;gap:8px">
      <select id="cost"></select>
      <button class="icon-btn" onclick="toggleCostMgr()">⚙️</button>
    </div>
  </div>
</div>

<!-- COST MANAGER -->
<div class="cost-manager" id="costMgr">
  <label>Add Cost Code</label>
  <div class="row">
    <input id="newCost" placeholder="CIV-200">
    <button class="btn gray" onclick="addCost()">Add</button>
  </div>
</div>

<!-- LF INPUT -->
<div class="row" style="margin-top:14px">
  <div class="col"><label>Dig LF</label><input type="number" id="dig"></div>
  <div class="col"><label>Lay LF</label><input type="number" id="lay"></div>
  <div class="col"><label>Backfill LF</label><input type="number" id="back"></div>
  <div class="col"><label>Tested LF</label><input type="number" id="test"></div>
</div>

<!-- ACTIONS -->
<div class="row" style="margin-top:18px">
  <button class="btn primary" onclick="save()">Save Day</button>
  <button class="btn success" onclick="exportCSV()">Export Filtered</button>
</div>

<!-- FILTERS -->
<div class="row" style="margin-top:18px">
  <div class="col"><label>Filter Project</label><input id="fProject"></div>
  <div class="col"><label>Filter Crew Lead</label><input id="fCrew"></div>
  <div class="col"><label>Start Date</label><input type="date" id="fStart"></div>
  <div class="col"><label>End Date</label><input type="date" id="fEnd"></div>
  <button class="btn gray" onclick="applyFilter()">Apply Filter</button>
</div>

<!-- KPIs -->
<div class="kpis">
  <div class="kpi"><span>Total Dig</span><strong id="kDig">0</strong></div>
  <div class="kpi"><span>Total Lay</span><strong id="kLay">0</strong></div>
  <div class="kpi"><span>Total Backfill</span><strong id="kBack">0</strong></div>
  <div class="kpi"><span>Total Physical LF</span><strong id="kPhys">0</strong></div>
  <div class="kpi"><span>Total Progress LF</span><strong id="kWip">0</strong></div>
</div>

<!-- TABLE -->
<table>
<thead>
<tr>
  <th>Date</th><th>Project</th><th>Crew Lead</th><th>Cost</th>
  <th>Dig</th><th>Lay</th><th>Backfill</th><th>Tested</th>
  <th>Total LF</th><th>WIP</th><th>Delete</th>
</tr>
</thead>
<tbody id="log"></tbody>
</table>

</div>

<!-- FIRESTORE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyChNb8zTdAPahDCgTah1W0CRpMS7S9wpI8",
  authDomain: "mc-underground-tracker.firebaseapp.com",
  projectId: "mc-underground-tracker"
});
const db = getFirestore(app);
const ref = collection(db,"entries");

let data=[];
let costs=["CIV-100"];

date.value=new Date().toISOString().split("T")[0];

onSnapshot(ref,s=>{
  data=s.docs.map(d=>({id:d.id,...d.data()}));
  render();
});

function render(){
  log.innerHTML="";
  let td=0,tl=0,tb=0,tp=0;
  data.forEach(e=>{
    td+=e.dig; tl+=e.lay; tb+=e.back; tp+=e.total;
    log.innerHTML+=`
    <tr>
      <td>${e.date}</td><td>${e.project}</td><td>${e.crew}</td><td>${e.cost}</td>
      <td>${e.dig}</td><td>${e.lay}</td><td>${e.back}</td><td>${e.test}</td>
      <td>${e.total}</td><td>${e.total}</td>
      <td><button class="del" onclick="del('${e.id}')">X</button></td>
    </tr>`;
  });
  kDig.textContent=td; kLay.textContent=tl; kBack.textContent=tb;
  kPhys.textContent=tp; kWip.textContent=tp;
}

window.save=async()=>{
  await addDoc(ref,{
    createdAt:serverTimestamp(),
    date:date.value,project:project.value,crew:crew.value,cost:cost.value,
    dig:+dig.value||0,lay:+lay.value||0,back:+back.value||0,test:+test.value||0,
    total:(+dig.value||0)+(+lay.value||0)+(+back.value||0)+(+test.value||0)
  });
};

window.del=id=>deleteDoc(doc(db,"entries",id));
window.applyFilter=()=>render();
window.exportCSV=()=>alert("CSV export next step");

window.toggleCostMgr=()=>costMgr.style.display=
  costMgr.style.display==="block"?"none":"block";

window.addCost=()=>{
  if(newCost.value){costs.push(newCost.value);renderCosts();newCost.value="";}
};

function renderCosts(){
  cost.innerHTML=costs.map(c=>`<option>${c}</option>`).join("");
}
renderCosts();
</script>
</body>
</html>
