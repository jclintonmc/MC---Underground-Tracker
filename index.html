<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Underground Linear FT Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
  --border:#374151; --primary:#2563eb; --success:#16a34a;
  --gray:#475569; --danger:#7f1d1d;
}
body{margin:0;padding:30px;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text)}
.card{max-width:1400px;margin:auto;background:var(--card);border-radius:18px;padding:26px;box-shadow:0 30px 60px rgba(0,0,0,.35)}
h1{margin:0;font-size:28px}
.subtitle{color:var(--muted);margin:6px 0 22px}
.row{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end}
.col{flex:1;min-width:180px}
label{font-size:12px;color:var(--muted)}
input,select{width:100%;padding:11px;border-radius:12px;border:1px solid var(--border);background:#020617;color:var(--text)}
.datewrap{display:flex;gap:8px;align-items:center}
.cal{width:44px;height:44px;border-radius:12px;border:1px solid var(--border);background:#1f2937;display:flex;align-items:center;justify-content:center;cursor:pointer}
.btn{padding:11px 20px;border-radius:14px;border:none;cursor:pointer}
.primary{background:var(--primary);color:white}
.success{background:var(--success);color:white}
.gray{background:var(--gray);color:white}
.danger{background:var(--danger);color:white}
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-top:26px}
.kpi{background:#020617;border-radius:999px;padding:18px;text-align:center}
.kpi span{font-size:12px;color:var(--muted)}
.kpi strong{display:block;font-size:22px}
table{width:100%;border-collapse:collapse;margin-top:26px}
th,td{border-bottom:1px solid var(--border);padding:10px;text-align:right}
th:first-child,td:first-child{text-align:left}
.del{background:#7f1d1d;color:white;border:none;border-radius:10px;padding:6px 10px;cursor:pointer}
.mode-box{background:#020617;border:1px solid var(--border);border-radius:14px;padding:12px}
.mode-box .weights{display:flex;gap:8px;margin-top:8px}
</style>
</head>

<body>
<div class="card">

<h1>Underground Linear FT Tracker</h1>
<div class="subtitle">Production + Activity-Distributed Progress Tracking</div>

<table>
<thead>
<tr>
  <th>Date</th><th>Project</th><th>Crew</th><th>Cost</th>
  <th>Dig</th><th>Lay</th><th>Back</th><th>Test</th>
  <th>Total</th><th>WIP</th><th>Del</th>
</tr>
</thead>
<tbody id="log"></tbody>
<tfoot>
<tr>
  <td colspan="8" style="text-align:right;font-weight:600">TOTAL LINEAR FT</td>
  <td id="tTotalLF" style="font-weight:700">0</td>
  <td></td><td></td>
</tr>
</tfoot>
</table>

</div>

<!-- ================= FIREBASE + APP LOGIC ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üîê Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyChNb8zTdAPahDCgTah1W0CRpMS7S9wpI8",
  authDomain: "mc-underground-tracker.firebaseapp.com",
  projectId: "mc-underground-tracker",
  storageBucket: "mc-underground-tracker.firebasestorage.app",
  messagingSenderId: "214694975194",
  appId: "1:214694975194:web:de814a7e23074faa37b7e3"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = collection(db,"entries");

let data = [];

/* üì• LOAD DATA */
async function loadData(){
  const q = query(ref, orderBy("date","desc"));
  const snap = await getDocs(q);
  data = snap.docs.map(d=>({ id:d.id, ...d.data() }));
  render();
}

/* üßÆ RENDER */
function render(){
  const log = document.getElementById("log");
  log.innerHTML = "";
  let total = 0;

  data.forEach(row=>{
    total += Number(row.total||0);
    log.innerHTML += `
      <tr>
        <td>${row.date}</td>
        <td>${row.project||""}</td>
        <td>${row.crew||""}</td>
        <td>${row.cost||""}</td>
        <td>${row.dig||0}</td>
        <td>${row.lay||0}</td>
        <td>${row.back||0}</td>
        <td>${row.test||0}</td>
        <td>${row.total||0}</td>
        <td>${Number(row.wip||0).toFixed(2)}</td>
        <td><button class="del" onclick="delRow('${row.id}')">X</button></td>
      </tr>`;
  });

  document.getElementById("tTotalLF").textContent = total;
}

/* ‚ùå DELETE */
window.delRow = async function(id){
  if(!confirm("Delete entry?")) return;
  await deleteDoc(doc(db,"entries",id));
  loadData();
}

/* üöÄ INIT */
loadData();
</script>

</body>
</html>
